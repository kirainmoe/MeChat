(this["webpackJsonpmechat-core"]=this["webpackJsonpmechat-core"]||[]).push([[0],{103:function(e,t){e.exports="data:image/jpeg;base64,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"},105:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var r=a(8),n=a(9),i=a(12),s=a(11),o=a(13),c=a(0),l=a.n(c),u=(a(119),function(e){function t(){var e,a;Object(r.a)(this,t);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return(a=Object(i.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(o)))).maximized=!1,a}return Object(o.a)(t,e),Object(n.a)(t,[{key:"closeWindow",value:function(){window.close()}},{key:"minimizeWindow",value:function(){window.browserWindow.getCurrentWindow().minimize()}},{key:"maximizeWindow",value:function(){this.maximized?window.browserWindow.getCurrentWindow().unmaximize():window.browserWindow.getCurrentWindow().maximize(),this.maximized=!this.maximized}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"mechat-top-button-container"},l.a.createElement("button",{className:"mechat-top-button-exit",onClick:function(){return e.closeWindow()}}),l.a.createElement("button",{className:"mechat-top-button-minimize",onClick:function(){return e.minimizeWindow()}}),l.a.createElement("button",{className:"mechat-top-button-maxmize",onClick:function(){return e.maximizeWindow()}}))}}]),t}(c.Component))},106:function(e,t,a){"use strict";var r,n=a(8),i=a(9),s=a(12),o=a(11),c=a(13),l=a(0),u=a.n(l),p=a(14),m=a(5),h=a(45),_=a.n(h),d=a(18),f=a.n(d),g=(a(201),a(7)),E=a(6),v=Object(E.b)("store")(r=Object(E.c)(r=function(e){function t(e){var r;return Object(n.a)(this,t),(r=Object(s.a)(this,Object(o.a)(t).call(this,e))).state={nickname:"MeChat",avatar:a(103)},r}return Object(c.a)(t,e),Object(i.a)(t,[{key:"login",value:function(){var e=this,t=this.usernameInput.value,a=_.a.createHash("md5").update(this.passwordInput.value).digest("hex"),r=g.a.apiUrl+"login";f.a.post(r,{data:{username:t,password:a}}).then((function(t){"string"===typeof t&&(t=JSON.parse(t)),200!==t.status?(console.log(t,typeof t),alert("\u767b\u5f55\u5931\u8d25\uff0c\u9519\u8bef\u4fe1\u606f\uff1a"+t.message)):(t.avatar=g.a.apiUrl+"avatar/"+t.avatar,sessionStorage.setItem("userInfo",JSON.stringify(t)),e.props.history.push("/app/message"))}))}},{key:"componentDidMount",value:function(){window.browserWindow.getCurrentWindow().setSize(300,500),this.usernameInput.focus()}},{key:"render",value:function(){var e=this;return u.a.createElement("div",{className:"mechat-loginpage"},u.a.createElement("div",{className:"mechat-login-personinfo"},u.a.createElement("p",{className:"mechat-login-avatar-container"},u.a.createElement("img",{className:"mechat-login-avatar",src:this.state.avatar,alt:"avatar"})),u.a.createElement("p",{className:"mechat-login-nickname"},this.state.nickname)),u.a.createElement("input",{type:"text",name:"username",className:"mechat-login-input-username",ref:function(t){return e.usernameInput=t},placeholder:"\u7528\u6237\u540d"}),u.a.createElement("input",{type:"password",name:"password",className:"mechat-login-input-password",ref:function(t){return e.passwordInput=t},placeholder:"\u5bc6\u7801"}),u.a.createElement("div",{className:"mechat-login-actions"},u.a.createElement("button",{type:"button",onClick:function(){return e.login()},className:"mechat-login-button"},"\u767b\u5f55"),u.a.createElement(p.b,{to:"/register",className:"mechat-login-register"},"\u6ca1\u6709\u8d26\u53f7\uff1f\u6ce8\u518c\u4e00\u4e2a")),u.a.createElement("div",{className:"mechat-login-copyright"},"\xa92019 XMU CS - Data Structure Experiment / by Yume Maruyama"))}}]),t}(l.Component))||r)||r;t.a=Object(m.e)(v)},109:function(e,t,a){"use strict";var r=a(8),n=a(9),i=a(12),s=a(11),o=a(13),c=a(0),l=a.n(c),u=a(14),p=a(5),m=a(45),h=a.n(m),_=a(18),d=a.n(_),f=(a(206),a(7)),g=function(e){function t(){return Object(r.a)(this,t),Object(i.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(o.a)(t,e),Object(n.a)(t,[{key:"register",value:function(){var e=this,t=this.usernameInput.value,a=h.a.createHash("md5").update(this.passwordInput.value).digest("hex"),r=this.mailInput.value,n=this.nicknameInput.value,i=f.a.apiUrl+"register";d.a.post(i,{data:{username:t,password:a,mail:r,nickname:n}}).then((function(t){"string"==typeof t&&(t=JSON.parse(t)),200!==t.status?(console.log(t,typeof t),alert("\u6ce8\u518c\u5931\u8d25\uff0c\u9519\u8bef\u4fe1\u606f\uff1a"+t.message)):(alert("\u6ce8\u518c\u6210\u529f~\u5c06\u56de\u5230\u767b\u5f55\u9875\u9762\u3002"),e.props.history.push("/"))}))}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"mechat-register-page"},l.a.createElement("h1",{className:"mechat-register-title"},"\u6ce8\u518c MeChat"),l.a.createElement("input",{type:"text",name:"username",className:"mechat-register-input-username",ref:function(t){return e.usernameInput=t},placeholder:"\u767b\u5f55\u7528\u6237\u540d"}),l.a.createElement("input",{type:"password",name:"password",className:"mechat-register-input-password",ref:function(t){return e.passwordInput=t},placeholder:"\u5bc6\u7801"}),l.a.createElement("input",{type:"mail",name:"mail",className:"mechat-register-input-mail",ref:function(t){return e.mailInput=t},placeholder:"\u90ae\u7bb1"}),l.a.createElement("input",{type:"text",name:"nickname",className:"mechat-register-input-nickname",ref:function(t){return e.nicknameInput=t},placeholder:"\u6635\u79f0"}),l.a.createElement("div",{className:"mechat-register-actions"},l.a.createElement("button",{type:"button",onClick:function(){return e.register()},className:"mechat-register-button"},"\u6ce8\u518c"),l.a.createElement(u.b,{to:"/",className:"mechat-register-login"},"\u5df2\u6709\u8d26\u53f7\uff1f\u767b\u5f55")))}}]),t}(c.Component);t.a=Object(p.e)(g)},110:function(e,t,a){"use strict";a.d(t,"a",(function(){return A}));var r,n,i,s,o,c,l,u,p,m,h,_,d,f,g,E,v,O=a(17),b=a(8),y=a(9),k=a(4),M=(a(212),a(1)),w=a(7),j=a(18),D=a.n(j),A=(r=function(){function e(){Object(b.a)(this,e),Object(O.a)(this,"nickname",n,this),Object(O.a)(this,"username",i,this),Object(O.a)(this,"uid",s,this),Object(O.a)(this,"mail",o,this),Object(O.a)(this,"signature",c,this),Object(O.a)(this,"avatar",l,this),Object(O.a)(this,"token",u,this),Object(O.a)(this,"friends",p,this),Object(O.a)(this,"groups",m,this),Object(O.a)(this,"socketLink",h,this),Object(O.a)(this,"messageList",_,this),Object(O.a)(this,"currentDialog",d,this),Object(O.a)(this,"chattingWith",f,this),Object(O.a)(this,"uidKeyMap",g,this),Object(O.a)(this,"fetching",E,this),Object(O.a)(this,"configUrl",v,this)}return Object(y.a)(e,[{key:"getRawChats",value:function(e){return this.messageList[e]?this.messageList[e].records:{}}},{key:"API",value:function(e){return this.configUrl.httpUrl+e}},{key:"wsAPI",value:function(e){return this.configUrl.wsUrl+e}},{key:"setUserInfo",value:function(e){this.nickname=e.nickname,this.username=e.username,this.signature=e.signature,this.uid=e.id,this.avatar=e.avatar,this.token=e.token,this.mail=e.mail}},{key:"setNewAvatar",value:function(e,t){this.avatar=t?e:this.API("avatar/")+e}},{key:"addFriend",value:function(e){this.friends.push(e),this.uidKeyMap[e.uid]=e}},{key:"updateFriends",value:function(e){var t=this;this.friends=e,e.forEach((function(e){t.uidKeyMap[e.uid]=e,t.messageList[e.uid]&&(t.messageList[e.uid].nickname=e.nickname,t.messageList[e.uid].avatar=e.avatar)}))}},{key:"connectSocketLink",value:function(e){this.socketLink=e}},{key:"addDialog",value:function(e){this.messageList[e]={with:e,nickname:this.uidKeyMap[e].nickname,avatar:this.uidKeyMap[e].avatar,last:Date.parse(new Date),read:!1,records:[]}}},{key:"replaceDialog",value:function(e){this.messageList=e}},{key:"setChattingWith",value:function(e,t,a){this.chattingWith={uid:e,nickname:t,avatar:a}}},{key:"sendMessage",value:function(e,t,a){this.messageList[e]||this.addDialog(e);var r=Date.parse(new Date);this.messageList[e].records.push({from:1,timestamp:r,type:a,content:t}),this.messageList[e].last=r}},{key:"setRead",value:function(e){this.messageList[e].read=!0}},{key:"reloadMessageList",value:function(){var e=this;this.fetching=!0;var t=w.a.apiUrl+"getMessageList";D.a.post(t,{data:{uid:this.uid,token:this.token}}).then((function(t){200===t.status?(e.replaceDialog(t.payload),e.fetching=!1):alert("\u62c9\u53d6\u6d88\u606f\u5217\u8868\u5931\u8d25 :(")}))}},{key:"pushNewMessage",value:function(e,t){console.log(e,this.messageList,this.uidKeyMap),this.messageList[e]||this.addDialog(e),this.messageList[e].read=!1,this.messageList[e].records.push(t)}}]),e}(),n=Object(k.a)(r.prototype,"nickname",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),i=Object(k.a)(r.prototype,"username",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),s=Object(k.a)(r.prototype,"uid",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),o=Object(k.a)(r.prototype,"mail",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),c=Object(k.a)(r.prototype,"signature",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),l=Object(k.a)(r.prototype,"avatar",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return a(103)}}),u=Object(k.a)(r.prototype,"token",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=Object(k.a)(r.prototype,"friends",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),m=Object(k.a)(r.prototype,"groups",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),h=Object(k.a)(r.prototype,"socketLink",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=Object(k.a)(r.prototype,"messageList",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),d=Object(k.a)(r.prototype,"currentDialog",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f=Object(k.a)(r.prototype,"chattingWith",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{uid:null,nickanme:null,avatar:null}}}),g=Object(k.a)(r.prototype,"uidKeyMap",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),E=Object(k.a)(r.prototype,"fetching",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),v=Object(k.a)(r.prototype,"configUrl",[M.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{httpUrl:w.a.apiUrl,wsUrl:w.a.wsUrl}}}),Object(k.a)(r.prototype,"getRawChats",[M.h],Object.getOwnPropertyDescriptor(r.prototype,"getRawChats"),r.prototype),Object(k.a)(r.prototype,"API",[M.h],Object.getOwnPropertyDescriptor(r.prototype,"API"),r.prototype),Object(k.a)(r.prototype,"wsAPI",[M.h],Object.getOwnPropertyDescriptor(r.prototype,"wsAPI"),r.prototype),Object(k.a)(r.prototype,"setUserInfo",[M.d],Object.getOwnPropertyDescriptor(r.prototype,"setUserInfo"),r.prototype),Object(k.a)(r.prototype,"setNewAvatar",[M.d],Object.getOwnPropertyDescriptor(r.prototype,"setNewAvatar"),r.prototype),Object(k.a)(r.prototype,"addFriend",[M.d],Object.getOwnPropertyDescriptor(r.prototype,"addFriend"),r.prototype),Object(k.a)(r.prototype,"updateFriends",[M.d],Object.getOwnPropertyDescriptor(r.prototype,"updateFriends"),r.prototype),Object(k.a)(r.prototype,"connectSocketLink",[M.d],Object.getOwnPropertyDescriptor(r.prototype,"connectSocketLink"),r.prototype),Object(k.a)(r.prototype,"addDialog",[M.d],Object.getOwnPropertyDescriptor(r.prototype,"addDialog"),r.prototype),Object(k.a)(r.prototype,"replaceDialog",[M.d],Object.getOwnPropertyDescriptor(r.prototype,"replaceDialog"),r.prototype),Object(k.a)(r.prototype,"setChattingWith",[M.d],Object.getOwnPropertyDescriptor(r.prototype,"setChattingWith"),r.prototype),Object(k.a)(r.prototype,"sendMessage",[M.d],Object.getOwnPropertyDescriptor(r.prototype,"sendMessage"),r.prototype),Object(k.a)(r.prototype,"setRead",[M.d],Object.getOwnPropertyDescriptor(r.prototype,"setRead"),r.prototype),Object(k.a)(r.prototype,"reloadMessageList",[M.d],Object.getOwnPropertyDescriptor(r.prototype,"reloadMessageList"),r.prototype),Object(k.a)(r.prototype,"pushNewMessage",[M.d],Object.getOwnPropertyDescriptor(r.prototype,"pushNewMessage"),r.prototype),r)},111:function(e,t,a){"use strict";var r,n,i,s,o,c,l,u=a(8),p=a(9),m=a(12),h=a(11),_=a(13),d=a(0),f=a.n(d),g=a(5),E=a(14),v=a(6),O=a(18),b=a.n(O),y=(a(207),a(7)),k=Object(v.b)("store")(r=Object(v.c)(r=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(p.a)(t,[{key:"logOut",value:function(){sessionStorage.removeItem("userInfo")}},{key:"render",value:function(){var e=this;return f.a.createElement("div",{className:"mechat-mainpage-nav"},f.a.createElement("div",{className:"mechat-nav-avatar-container"},f.a.createElement(E.b,{to:"/app/editProfile"},f.a.createElement("img",{className:"mechat-nav-avatar",alt:"avatar",src:this.props.store.avatar,title:this.props.store.nickname}))),f.a.createElement(E.c,{to:"/app/message",title:"\u6d88\u606f"},f.a.createElement("i",{className:"fa fa-comments-o"})),f.a.createElement(E.c,{to:"/app/friends",title:"\u901a\u8baf\u5f55"},f.a.createElement("i",{className:"fa fa-address-book-o"})),f.a.createElement(E.b,{to:"/",title:"\u6ce8\u9500",onClick:function(){return e.logOut()}},f.a.createElement("i",{className:"fa fa-mail-reply"})))}}]),t}(d.Component))||r)||r,M=Object(g.e)(k),w=Object(v.b)("store")(n=Object(v.c)(n=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(p.a)(t,[{key:"getAvatar",value:function(e){return y.a.apiUrl+"avatar/"+e}},{key:"chatWith",value:function(e){this.props.store.setRead(e.with),this.props.store.setChattingWith(e.with,e.nickname,e.avatar)}},{key:"renderMessageList",value:function(){var e=this,t=[],a=0,r=function(r){var n=e.props.store.messageList[r],i=new Date(n.last),s=new Date,o="";i.getMonth()===s.getMonth()&&i.getDate()===s.getDate()&&(o+=i.getHours()<10?"0"+i.getHours():i.getHours(),o+=":",o+=i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes()),t.push(f.a.createElement(E.c,{className:"mechat-dialog",to:"/app/message/"+n.with,key:a++,onClick:function(){return e.chatWith(n)}},f.a.createElement("div",{className:"mechat-dialog-avatar"},f.a.createElement("img",{src:e.getAvatar(n.avatar),alt:"avatar"}),n.read?null:f.a.createElement("span",{className:"mechat-dialog-new"})),f.a.createElement("div",{className:"mechat-dialog-meta"},f.a.createElement("p",{className:"mechat-dialog-title"},n.nickname),f.a.createElement("p",{className:"mechat-dialog-mess"},n.records.length?n.records[n.records.length-1].content:""),f.a.createElement("span",{className:"mechat-dialog-time"},o))))};for(var n in this.props.store.messageList)r(n);return t}},{key:"render",value:function(){var e=this;return f.a.createElement("div",{className:"mechat-messages"},f.a.createElement("h1",{className:"mechat-messages-title"},"\u6d88\u606f\u5217\u8868"),f.a.createElement("div",{className:"mechat-messages-fetching",style:{display:this.props.store.fetching?"block":"none"}},"\u6b63\u5728\u66f4\u65b0\u6d88\u606f\u5217\u8868..."),f.a.createElement("div",{className:"mechat-messages-list"},e.renderMessageList()))}}]),t}(d.Component))||n)||n,j=(a(208),Object(v.b)("store")(i=Object(v.c)(i=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(p.a)(t,[{key:"getAvatar",value:function(e){return y.a.apiUrl+"avatar/"+e}},{key:"componentDidMount",value:function(){var e=this;document.onkeydown=function(t){var a=t.which?t.which:t.keyCode;t.ctrlKey&&13===a&&e.sendMessage()},this.chatContent.scrollTop=this.chatContent.scrollHeight}},{key:"componentWillUnmount",value:function(){document.onkeydown=null}},{key:"renderChatContent",value:function(){var e=this,t=[],a=this.props.match.params.id,r=this.props.store.getRawChats(a),n=this.props.store.avatar,i=0;if(r.forEach)return r.forEach((function(a){t.push(f.a.createElement("div",{className:"mechat-chat-item"+(1===a.from?" from-me":""),key:i++},f.a.createElement("div",{className:"mechat-chat-item-avatar"},f.a.createElement("img",{src:0===a.from?e.getAvatar(e.props.store.chattingWith.avatar):n,alt:"avatar"})),f.a.createElement("div",{className:"mechat-chat-item-blob"},a.content)))})),t;this.props.store.reloadMessageList()}},{key:"sendMessage",value:function(){var e=this.textarea.value,t=this.props.match.params.id;this.props.store.sendMessage(t,e,"string"),this.props.store.setRead(t),this.textarea.value="",this.chatContent.scrollTop=this.chatContent.scrollHeight,b.a.post(y.a.apiUrl+"sendMessage",{data:{uid:this.props.store.uid,to:t,type:"string",content:e,token:this.props.store.token}}).then((function(e){if(200!==e.status)return alert("\u53d1\u9001\u4fe1\u606f\u5931\u8d25\uff0c\u539f\u56e0\u53ef\u80fd\u662f\uff1a"+e.message),void console.log(e)}))}},{key:"render",value:function(){var e=this;return f.a.createElement("div",{className:"mechat-chat-page"},f.a.createElement("div",{className:"mechat-chat-title"},this.props.store.chattingWith.nickname),f.a.createElement("div",{className:"mechat-chat-content",ref:function(t){return e.chatContent=t}},e.renderChatContent()),f.a.createElement("div",{className:"mechat-chat-textarea"},f.a.createElement("textarea",{name:"chat-text",ref:function(t){return e.textarea=t}}),f.a.createElement("button",{className:"mechat-chat-send",onClick:function(){return e.sendMessage()}},"\u53d1\u9001")))}}]),t}(d.Component))||i)||i),D=Object(g.e)(j),A=(a(209),Object(v.b)("store")(s=Object(v.c)(s=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(p.a)(t,[{key:"renderFriendsList",value:function(){var e=[],t=0;return this.props.store.friends.forEach((function(a){e.push(f.a.createElement(E.c,{className:"mechat-dialog",to:"/app/friends/"+a.uid,key:t++},f.a.createElement("div",{className:"mechat-dialog-avatar"},f.a.createElement("img",{src:y.a.apiUrl+"avatar/"+a.avatar,alt:"avatar"})),f.a.createElement("div",{className:"mechat-dialog-meta"},f.a.createElement("p",{className:"mechat-dialog-title"},a.nickname),f.a.createElement("p",{className:"mechat-dialog-mess"},a.signature))))})),e}},{key:"componentWillMount",value:function(){var e=this,t=y.a.apiUrl+"friends";b.a.post(t,{data:{uid:this.props.store.uid,token:this.props.store.token}}).then((function(t){200!==t.status?(alert("\u8eab\u4efd\u8ba4\u8bc1\u51fa\u73b0\u95ee\u9898\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002"),sessionStorage.removeItem("userInfo"),e.props.history.push("/")):e.props.store.updateFriends(t.payload)}))}},{key:"addFriend",value:function(){var e=this,t=this.input.value,a=y.a.apiUrl+"addFriend";b.a.post(a,{data:{uid:this.props.store.uid,token:this.props.store.token,friend:t}}).then((function(t){403===t.status?(alert("\u8eab\u4efd\u8ba4\u8bc1\u51fa\u73b0\u95ee\u9898\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002"),sessionStorage.removeItem("userInfo"),e.props.history.push("/")):200===t.status?(alert("\u6dfb\u52a0\u597d\u53cb\u6210\u529f."),e.props.store.addFriend(t.payload)):alert("\u6dfb\u52a0\u597d\u53cb\u5931\u8d25\uff0c\u539f\u56e0\u662f\uff1a"+t.message)}))}},{key:"render",value:function(){var e=this;return f.a.createElement("div",{className:"mechat-messages"},f.a.createElement("h1",{className:"mechat-messages-title"},"\u670b\u53cb"),f.a.createElement("div",{className:"mechat-friends-add"},f.a.createElement("input",{type:"text",name:"friends",placeholder:"\u641c\u7d22 MeChat \u8d26\u53f7\u6dfb\u52a0\u597d\u53cb",ref:function(t){return e.input=t}}),f.a.createElement("button",{onClick:function(){return e.addFriend()}},"+")),f.a.createElement("div",{className:"mechat-messages-list"},e.renderFriendsList()))}}]),t}(d.Component))||s)||s),C=(a(210),Object(v.b)("store")(o=Object(v.c)(o=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(p.a)(t,[{key:"chatWith",value:function(e,t,a){this.props.store.messageList[e]||this.props.store.addDialog(e),this.props.store.setChattingWith(e,t,a)}},{key:"getAvatar",value:function(e){return y.a.apiUrl+"avatar/"+e}},{key:"render",value:function(){var e,t=this,a=this.props.match.params.id;return this.props.store.uidKeyMap[a]&&(e=this.props.store.uidKeyMap[a]),console.log(e),f.a.createElement("div",{className:"mechat-profile-page"},f.a.createElement("p",{className:"mechat-profile-title"},"\u4e2a\u4eba\u8d44\u6599"),f.a.createElement("div",{className:"mechat-profile-container"},f.a.createElement("div",{className:"mechat-profile-avatar"},f.a.createElement("img",{src:this.getAvatar(e.avatar),alt:"avatar"})),f.a.createElement("div",{className:"mechat-profile-meta"},f.a.createElement("h1",{className:"mechat-profile-nickname"},e.nickname),f.a.createElement("p",{className:"mechat-profile-account"},"MeChat \u8d26\u53f7\uff1a",e.username),f.a.createElement("p",{className:"mechat-profile-signature"},"\u7b7e\u540d\uff1a",e.signature?e.signature:"\u65e0"),f.a.createElement(E.b,{className:"mechat-profile-chat",to:"/app/message/"+e.uid,onClick:function(){return t.chatWith(e.uid,e.nickname,e.avatar)}},"\u804a\u5929"))))}}]),t}(d.Component))||o)||o),I=Object(g.e)(C),P=(a(211),Object(v.b)("store")(c=Object(v.c)(c=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(p.a)(t,[{key:"editProfile",value:function(){var e=this,t=this.nickname.value,a=this.mail.value,r=this.signature.value,n=this.props.store,i=n.avatar,s=n.token,o=n.uid;if(""!==t&&""!==a){if(this.avatarUpload.files.length){if(this.avatarUpload.files[0].size/1024/1024>1)return void alert("\u4e0a\u4f20\u7684\u5934\u50cf\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7 1MB\uff0c\u8bf7\u91cd\u65b0\u9009\u62e9\u56fe\u7247\u3002");var c=new FormData;c.append("avatar",this.avatarUpload.files[0]),c.append("uid",this.props.store.uid),c.append("token",this.props.store.token),fetch(this.props.store.API("uploadAvatar"),{method:"POST",headers:{},body:c}).then((function(e){return e.json()})).then((function(t){if(403===t.status)alert("\u8eab\u4efd\u9a8c\u8bc1\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002"),sessionStorage.removeItem("userInfo"),e.props.history.push("/");else if(200===t.status){var a=e.avatarUpload.files[0],r=window.URL.createObjectURL(a);e.props.store.setNewAvatar(r,!0)}}))}this.props.store.setUserInfo({nickname:t,mail:a,signature:r,avatar:i,token:s,id:o}),b.a.post(this.props.store.API("updateProfile"),{data:{nickname:t,mail:a,signature:r,uid:o,token:s}}).then((function(t){403===t.status?(alert("\u8eab\u4efd\u9a8c\u8bc1\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002"),sessionStorage.removeItem("userInfo"),e.props.history.push("/")):200===t.status&&alert("\u4fee\u6539\u6210\u529f\u3002")}))}else alert("\u6635\u79f0\u548c\u90ae\u7bb1\u4e0d\u8bb8\u7559\u7a7a\uff01")}},{key:"selectAvatar",value:function(){this.avatarUpload.click()}},{key:"onFileLoadChange",value:function(e){var t=this.avatarUpload.files[0],a=window.URL.createObjectURL(t);this.avatar.setAttribute("src",a)}},{key:"render",value:function(){var e=this;return f.a.createElement("div",{className:"mechat-profile-edit"},f.a.createElement("p",{className:"mechat-profile-edit-title"},"\u4fee\u6539\u4e2a\u4eba\u8d44\u6599"),f.a.createElement("div",{className:"mechat-profile-edit-container"},f.a.createElement("div",{className:"mechat-profile-edit-avatar"},f.a.createElement("img",{src:this.props.store.avatar,alt:"my-avatar",onClick:function(){e.selectAvatar()},ref:function(t){return e.avatar=t},title:"\u70b9\u51fb\u4fee\u6539\u5934\u50cf"})),f.a.createElement("form",{ref:function(t){return e.uploadForm=t},action:this.props.store.API("uploadAvatar"),method:"post",encType:"multipart/form-data"},f.a.createElement("input",{type:"file",name:"avatar-upload",ref:function(t){return e.avatarUpload=t},style:{display:"none"},accept:"image/*",onChange:function(t){return e.onFileLoadChange(t)}})),f.a.createElement("div",{className:"mechat-profile-edit-form"},f.a.createElement("span",null,"\u6635\u79f0"),f.a.createElement("input",{type:"text",defaultValue:this.props.store.nickname,ref:function(t){return e.nickname=t}})),f.a.createElement("div",{className:"mechat-profile-edit-form"},f.a.createElement("span",null,"\u90ae\u7bb1"),f.a.createElement("input",{type:"text",defaultValue:this.props.store.mail,ref:function(t){return e.mail=t}})),f.a.createElement("div",{className:"mechat-profile-edit-form"},f.a.createElement("span",null,"\u7b7e\u540d"),f.a.createElement("input",{type:"text",defaultValue:this.props.store.signature,ref:function(t){return e.signature=t}})),f.a.createElement("div",{className:"mechat-profile-edit-action"},f.a.createElement("button",{className:"mechat-profile-edit-submit",onClick:function(){return e.editProfile()}},"\u4fee\u6539"))))}}]),t}(d.Component))||c)||c),L=Object(g.e)(P),N=Object(v.b)("store")(l=Object(v.c)(l=function(e){function t(){return Object(u.a)(this,t),Object(m.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(p.a)(t,[{key:"createSocketConnection",value:function(){var e=this;this.ws=new WebSocket(y.a.wsUrl);var t=this.ws;t.addEventListener("open",(function(){console.log("WebSocket opened."),t.send(JSON.stringify({uid:e.props.store.uid,token:e.props.store.token}))})),t.addEventListener("message",(function(t){switch((t=JSON.parse(t.data)).type){case"message":e.props.store.pushNewMessage(t.from,t.payload)}})),t.addEventListener("error",(function(){alert("\u8fde\u63a5\u9519\u8bef\u3002\u8fd4\u56de\u767b\u5f55\u9875\u9762..."),e.props.history.push("/")}))}},{key:"componentWillMount",value:function(){var e=this;null==sessionStorage.getItem("userInfo")?this.props.history.push("/"):this.props.store.setUserInfo(JSON.parse(sessionStorage.getItem("userInfo"))),this.createSocketConnection();var t=y.a.apiUrl+"friends";b.a.post(t,{data:{uid:this.props.store.uid,token:this.props.store.token}}).then((function(t){200!==t.status?(alert("\u8eab\u4efd\u8ba4\u8bc1\u51fa\u73b0\u95ee\u9898\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002"),sessionStorage.removeItem("userInfo"),e.props.history.push("/")):e.props.store.updateFriends(t.payload)})),this.props.store.reloadMessageList()}},{key:"componentWillUnmount",value:function(){this.ws.close()}},{key:"componentDidMount",value:function(){window.browserWindow.getCurrentWindow().setSize(800,600)}},{key:"render",value:function(){return f.a.createElement("div",{className:"mechat-mainpage"},f.a.createElement(E.a,{history:this.props.history},f.a.createElement(g.a,{path:"/app"},f.a.createElement(M,null)),f.a.createElement(g.a,{path:"/app/message"},f.a.createElement(w,null)),f.a.createElement(g.a,{path:"/app/message/:id"},f.a.createElement(D,null)),f.a.createElement(g.a,{path:"/app/friends"},f.a.createElement(A,null)),f.a.createElement(g.a,{path:"/app/friends/:id"},f.a.createElement(I,null)),f.a.createElement(g.a,{path:"/app/editProfile"},f.a.createElement(A,null),f.a.createElement(L,null))))}}]),t}(d.Component))||l)||l;t.a=Object(g.e)(N)},112:function(e,t,a){e.exports=a(113)},113:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),react_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(39),react_dom__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react_dom__WEBPACK_IMPORTED_MODULE_1__),mobx_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6),react_router__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5),react_router_dom__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(14),history__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(19),_styles_index_styl__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(118),_styles_index_styl__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_styles_index_styl__WEBPACK_IMPORTED_MODULE_6__),_components_TopButton__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(105),_components_LoginPage__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(106),_components_RegisterPage__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(109),_components_MainPage__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(111),_models__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(110);eval('window.browserWindow = require("electron").remote');var history=Object(history__WEBPACK_IMPORTED_MODULE_5__.a)(),store=new _models__WEBPACK_IMPORTED_MODULE_11__.a;react_dom__WEBPACK_IMPORTED_MODULE_1___default.a.render(react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{className:"mechat",id:"mechat"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(mobx_react__WEBPACK_IMPORTED_MODULE_2__.a,{store:store},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_components_TopButton__WEBPACK_IMPORTED_MODULE_7__.a,null),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react_router_dom__WEBPACK_IMPORTED_MODULE_4__.a,{history:history},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react_router__WEBPACK_IMPORTED_MODULE_3__.a,{path:"/",exact:!0},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_components_LoginPage__WEBPACK_IMPORTED_MODULE_8__.a,null)),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react_router__WEBPACK_IMPORTED_MODULE_3__.a,{path:"/register",exact:!0},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_components_RegisterPage__WEBPACK_IMPORTED_MODULE_9__.a,null)),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react_router__WEBPACK_IMPORTED_MODULE_3__.a,{path:"/app"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_components_MainPage__WEBPACK_IMPORTED_MODULE_10__.a,null))))),document.getElementById("root"))},118:function(e,t,a){},119:function(e,t,a){},122:function(e,t){},124:function(e,t){},158:function(e,t){},159:function(e,t){},201:function(e,t,a){},206:function(e,t,a){},207:function(e,t,a){},208:function(e,t,a){},209:function(e,t,a){},210:function(e,t,a){},211:function(e,t,a){},7:function(e,t,a){"use strict";t.a={apiUrl:"http://103.81.187.96:61616/",wsUrl:"ws://103.81.187.96:61616/entry"}}},[[112,1,2]]]);
//# sourceMappingURL=main.a359648f.chunk.js.map