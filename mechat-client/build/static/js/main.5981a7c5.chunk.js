(this["webpackJsonpmechat-core"]=this["webpackJsonpmechat-core"]||[]).push([[0],{103:function(e,t){e.exports="data:image/jpeg;base64,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"},105:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(9),r=a(10),s=a(13),i=a(12),o=a(14),c=a(0),l=a.n(c),u=(a(119),function(e){function t(){var e,a;Object(n.a)(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(a=Object(s.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(o)))).maximized=!1,a}return Object(o.a)(t,e),Object(r.a)(t,[{key:"closeWindow",value:function(){window.close()}},{key:"minimizeWindow",value:function(){window.browserWindow.getCurrentWindow().minimize()}},{key:"maximizeWindow",value:function(){this.maximized?window.browserWindow.getCurrentWindow().unmaximize():window.browserWindow.getCurrentWindow().maximize(),this.maximized=!this.maximized}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"mechat-top-button-container"},l.a.createElement("button",{className:"mechat-top-button-exit",onClick:function(){return e.closeWindow()}}),l.a.createElement("button",{className:"mechat-top-button-minimize",onClick:function(){return e.minimizeWindow()}}),l.a.createElement("button",{className:"mechat-top-button-maxmize",onClick:function(){return e.maximizeWindow()}}))}}]),t}(c.Component))},106:function(e,t,a){"use strict";var n,r=a(9),s=a(10),i=a(13),o=a(12),c=a(14),l=a(0),u=a.n(l),p=a(15),m=a(5),h=a(45),_=a.n(h),d=a(19),g=a.n(d),E=(a(201),a(7)),f=a(6),O=Object(f.b)("store")(n=Object(f.c)(n=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(i.a)(this,Object(o.a)(t).call(this,e))).state={nickname:"MeChat",avatar:a(103)},n}return Object(c.a)(t,e),Object(s.a)(t,[{key:"login",value:function(){var e=this,t=this.usernameInput.value,a=_.a.createHash("md5").update(this.passwordInput.value).digest("hex"),n=E.a.apiUrl+"login";g.a.post(n,{data:{username:t,password:a}}).then((function(t){"string"==typeof t&&(t=JSON.parse(t)),console.log(t),200!==t.status?(console.log(t,typeof t),alert("\u767b\u5f55\u5931\u8d25\uff0c\u9519\u8bef\u4fe1\u606f\uff1a"+t.message)):(t.avatar=E.a.apiUrl+"avatar/"+t.avatar,sessionStorage.setItem("userInfo",JSON.stringify(t)),e.props.history.push("/app/message"))}))}},{key:"componentDidMount",value:function(){window.browserWindow.getCurrentWindow().setSize(300,500),this.usernameInput.focus()}},{key:"render",value:function(){var e=this;return u.a.createElement("div",{className:"mechat-loginpage"},u.a.createElement("div",{className:"mechat-login-personinfo"},u.a.createElement("p",{className:"mechat-login-avatar-container"},u.a.createElement("img",{className:"mechat-login-avatar",src:this.state.avatar,alt:"avatar"})),u.a.createElement("p",{className:"mechat-login-nickname"},this.state.nickname)),u.a.createElement("input",{type:"text",name:"username",className:"mechat-login-input-username",ref:function(t){return e.usernameInput=t},placeholder:"\u7528\u6237\u540d"}),u.a.createElement("input",{type:"password",name:"password",className:"mechat-login-input-password",ref:function(t){return e.passwordInput=t},placeholder:"\u5bc6\u7801"}),u.a.createElement("div",{className:"mechat-login-actions"},u.a.createElement("button",{type:"button",onClick:function(){return e.login()},className:"mechat-login-button"},"\u767b\u5f55"),u.a.createElement(p.b,{to:"/register",className:"mechat-login-register"},"\u6ca1\u6709\u8d26\u53f7\uff1f\u6ce8\u518c\u4e00\u4e2a")),u.a.createElement("div",{className:"mechat-login-copyright"},"\xa92019 XMU CS - Data Structure Experiment / by Yume Maruyama"))}}]),t}(l.Component))||n)||n;t.a=Object(m.e)(O)},109:function(e,t,a){"use strict";var n=a(9),r=a(10),s=a(13),i=a(12),o=a(14),c=a(0),l=a.n(c),u=a(15),p=a(5),m=a(45),h=a.n(m),_=a(19),d=a.n(_),g=(a(206),a(7)),E=function(e){function t(){return Object(n.a)(this,t),Object(s.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(o.a)(t,e),Object(r.a)(t,[{key:"register",value:function(){var e=this,t=this.usernameInput.value,a=h.a.createHash("md5").update(this.passwordInput.value).digest("hex"),n=this.mailInput.value,r=this.nicknameInput.value,s=g.a.apiUrl+"register";d.a.post(s,{data:{username:t,password:a,mail:n,nickname:r}}).then((function(t){"string"==typeof t&&(t=JSON.parse(t)),200!==t.status?(console.log(t,typeof t),alert("\u6ce8\u518c\u5931\u8d25\uff0c\u9519\u8bef\u4fe1\u606f\uff1a"+t.message)):(alert("\u6ce8\u518c\u6210\u529f~\u5c06\u56de\u5230\u767b\u5f55\u9875\u9762\u3002"),e.props.history.push("/"))}))}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"mechat-register-page"},l.a.createElement("h1",{className:"mechat-register-title"},"\u6ce8\u518c MeChat"),l.a.createElement("input",{type:"text",name:"username",className:"mechat-register-input-username",ref:function(t){return e.usernameInput=t},placeholder:"\u767b\u5f55\u7528\u6237\u540d"}),l.a.createElement("input",{type:"password",name:"password",className:"mechat-register-input-password",ref:function(t){return e.passwordInput=t},placeholder:"\u5bc6\u7801"}),l.a.createElement("input",{type:"mail",name:"mail",className:"mechat-register-input-mail",ref:function(t){return e.mailInput=t},placeholder:"\u90ae\u7bb1"}),l.a.createElement("input",{type:"text",name:"nickname",className:"mechat-register-input-nickname",ref:function(t){return e.nicknameInput=t},placeholder:"\u6635\u79f0"}),l.a.createElement("div",{className:"mechat-register-actions"},l.a.createElement("button",{type:"button",onClick:function(){return e.register()},className:"mechat-register-button"},"\u6ce8\u518c"),l.a.createElement(u.b,{to:"/",className:"mechat-register-login"},"\u5df2\u6709\u8d26\u53f7\uff1f\u767b\u5f55")))}}]),t}(c.Component);t.a=Object(p.e)(E)},110:function(e,t,a){"use strict";a.d(t,"a",(function(){return j}));var n,r,s,i,o,c,l,u,p,m,h,_,d,g,E,f,O=a(17),b=a(9),v=a(10),y=a(4),k=(a(211),a(1)),M=a(7),D=a(19),w=a.n(D),j=(n=function(){function e(){Object(b.a)(this,e),Object(O.a)(this,"nickname",r,this),Object(O.a)(this,"username",s,this),Object(O.a)(this,"uid",i,this),Object(O.a)(this,"mail",o,this),Object(O.a)(this,"signature",c,this),Object(O.a)(this,"avatar",l,this),Object(O.a)(this,"token",u,this),Object(O.a)(this,"friends",p,this),Object(O.a)(this,"groups",m,this),Object(O.a)(this,"socketLink",h,this),Object(O.a)(this,"messageList",_,this),Object(O.a)(this,"currentDialog",d,this),Object(O.a)(this,"chattingWith",g,this),Object(O.a)(this,"uidKeyMap",E,this),Object(O.a)(this,"fetching",f,this)}return Object(v.a)(e,[{key:"getRawChats",value:function(e){return this.messageList[e]?this.messageList[e].records:{}}},{key:"setUserInfo",value:function(e){console.log(e),this.nickname=e.nickname,this.username=e.username,this.signature=e.signature,this.uid=e.id,this.avatar=e.avatar,this.token=e.token,this.mail=e.mail}},{key:"addFriend",value:function(e){this.friends.push(e),this.uidKeyMap[e.uid]=e}},{key:"updateFriends",value:function(e){var t=this;this.friends=e,e.forEach((function(e){t.uidKeyMap[e.uid]=e}))}},{key:"connectSocketLink",value:function(e){this.socketLink=e}},{key:"addDialog",value:function(e){this.messageList[e]={with:e,nickname:this.uidKeyMap[e].nickname,avatar:this.uidKeyMap[e].avatar,last:Date.parse(new Date),read:!1,records:[]}}},{key:"replaceDialog",value:function(e){this.messageList=e}},{key:"setChattingWith",value:function(e,t,a){this.chattingWith={uid:e,nickname:t,avatar:a}}},{key:"sendMessage",value:function(e,t,a){this.messageList[e]||this.addDialog(e);var n=Date.parse(new Date);this.messageList[e].records.push({from:1,timestamp:n,type:a,content:t}),this.messageList[e].last=n}},{key:"setRead",value:function(e){this.messageList[e].read=!0}},{key:"reloadMessageList",value:function(){var e=this;this.fetching=!0;var t=M.a.apiUrl+"getMessageList";w.a.post(t,{data:{uid:this.uid,token:this.token}}).then((function(t){200===t.status?(e.replaceDialog(t.payload),e.fetching=!1):alert("\u62c9\u53d6\u6d88\u606f\u5217\u8868\u5931\u8d25 :(")}))}},{key:"pushNewMessage",value:function(e,t){console.log(e,this.messageList,this.uidKeyMap),this.messageList[e]||this.addDialog(e),this.messageList[e].read=!1,this.messageList[e].records.push(t)}}]),e}(),r=Object(y.a)(n.prototype,"nickname",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),s=Object(y.a)(n.prototype,"username",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),i=Object(y.a)(n.prototype,"uid",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),o=Object(y.a)(n.prototype,"mail",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),c=Object(y.a)(n.prototype,"signature",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),l=Object(y.a)(n.prototype,"avatar",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return a(103)}}),u=Object(y.a)(n.prototype,"token",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=Object(y.a)(n.prototype,"friends",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),m=Object(y.a)(n.prototype,"groups",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),h=Object(y.a)(n.prototype,"socketLink",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=Object(y.a)(n.prototype,"messageList",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),d=Object(y.a)(n.prototype,"currentDialog",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=Object(y.a)(n.prototype,"chattingWith",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{uid:null,nickanme:null,avatar:null}}}),E=Object(y.a)(n.prototype,"uidKeyMap",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),f=Object(y.a)(n.prototype,"fetching",[k.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(y.a)(n.prototype,"getRawChats",[k.h],Object.getOwnPropertyDescriptor(n.prototype,"getRawChats"),n.prototype),Object(y.a)(n.prototype,"setUserInfo",[k.d],Object.getOwnPropertyDescriptor(n.prototype,"setUserInfo"),n.prototype),Object(y.a)(n.prototype,"addFriend",[k.d],Object.getOwnPropertyDescriptor(n.prototype,"addFriend"),n.prototype),Object(y.a)(n.prototype,"updateFriends",[k.d],Object.getOwnPropertyDescriptor(n.prototype,"updateFriends"),n.prototype),Object(y.a)(n.prototype,"connectSocketLink",[k.d],Object.getOwnPropertyDescriptor(n.prototype,"connectSocketLink"),n.prototype),Object(y.a)(n.prototype,"addDialog",[k.d],Object.getOwnPropertyDescriptor(n.prototype,"addDialog"),n.prototype),Object(y.a)(n.prototype,"replaceDialog",[k.d],Object.getOwnPropertyDescriptor(n.prototype,"replaceDialog"),n.prototype),Object(y.a)(n.prototype,"setChattingWith",[k.d],Object.getOwnPropertyDescriptor(n.prototype,"setChattingWith"),n.prototype),Object(y.a)(n.prototype,"sendMessage",[k.d],Object.getOwnPropertyDescriptor(n.prototype,"sendMessage"),n.prototype),Object(y.a)(n.prototype,"setRead",[k.d],Object.getOwnPropertyDescriptor(n.prototype,"setRead"),n.prototype),Object(y.a)(n.prototype,"reloadMessageList",[k.d],Object.getOwnPropertyDescriptor(n.prototype,"reloadMessageList"),n.prototype),Object(y.a)(n.prototype,"pushNewMessage",[k.d],Object.getOwnPropertyDescriptor(n.prototype,"pushNewMessage"),n.prototype),n)},111:function(e,t,a){"use strict";var n,r,s,i,o,c,l=a(9),u=a(10),p=a(13),m=a(12),h=a(14),_=a(0),d=a.n(_),g=a(5),E=a(15),f=a(6),O=a(19),b=a.n(O),v=(a(207),a(7)),y=Object(f.b)("store")(n=Object(f.c)(n=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"logOut",value:function(){sessionStorage.removeItem("userInfo")}},{key:"render",value:function(){var e=this;return d.a.createElement("div",{className:"mechat-mainpage-nav"},d.a.createElement("div",{className:"mechat-nav-avatar-container"},d.a.createElement("img",{className:"mechat-nav-avatar",alt:"avatar",src:this.props.store.avatar,title:this.props.store.nickname})),d.a.createElement(E.c,{to:"/app/message",title:"\u6d88\u606f"},d.a.createElement("i",{className:"fa fa-comments-o"})),d.a.createElement(E.c,{to:"/app/friends",title:"\u901a\u8baf\u5f55"},d.a.createElement("i",{className:"fa fa-address-book-o"})),d.a.createElement(E.b,{to:"/",title:"\u6ce8\u9500",onClick:function(){return e.logOut()}},d.a.createElement("i",{className:"fa fa-mail-reply"})))}}]),t}(_.Component))||n)||n,k=Object(g.e)(y),M=Object(f.b)("store")(r=Object(f.c)(r=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"getAvatar",value:function(e){return v.a.apiUrl+"avatar/"+e}},{key:"chatWith",value:function(e){this.props.store.setRead(e.with),this.props.store.setChattingWith(e.with,e.nickname,e.avatar)}},{key:"renderMessageList",value:function(){var e=this,t=[],a=0,n=function(n){var r=e.props.store.messageList[n],s=new Date(r.last),i=new Date,o="";s.getMonth()===i.getMonth()&&s.getDate()===i.getDate()&&(o+=s.getHours()<10?"0"+s.getHours():s.getHours(),o+=":",o+=s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes()),t.push(d.a.createElement(E.c,{className:"mechat-dialog",to:"/app/message/"+r.with,key:a++,onClick:function(){return e.chatWith(r)}},d.a.createElement("div",{className:"mechat-dialog-avatar"},d.a.createElement("img",{src:e.getAvatar(r.avatar),alt:"avatar"}),r.read?null:d.a.createElement("span",{className:"mechat-dialog-new"})),d.a.createElement("div",{className:"mechat-dialog-meta"},d.a.createElement("p",{className:"mechat-dialog-title"},r.nickname),d.a.createElement("p",{className:"mechat-dialog-mess"},r.records.length?r.records[r.records.length-1].content:""),d.a.createElement("span",{className:"mechat-dialog-time"},o))))};for(var r in this.props.store.messageList)n(r);return t}},{key:"render",value:function(){var e=this;return d.a.createElement("div",{className:"mechat-messages"},d.a.createElement("h1",{className:"mechat-messages-title"},"\u6d88\u606f\u5217\u8868"),d.a.createElement("div",{className:"mechat-messages-fetching",style:{display:this.props.store.fetching?"block":"none"}},"\u6b63\u5728\u66f4\u65b0\u6d88\u606f\u5217\u8868..."),d.a.createElement("div",{className:"mechat-messages-list"},e.renderMessageList()))}}]),t}(_.Component))||r)||r,D=(a(208),Object(f.b)("store")(s=Object(f.c)(s=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"getAvatar",value:function(e){return v.a.apiUrl+"avatar/"+e}},{key:"componentDidMount",value:function(){var e=this;document.onkeydown=function(t){var a=t.which?t.which:t.keyCode;t.ctrlKey&&13===a&&e.sendMessage()},this.chatContent.scrollTop=this.chatContent.scrollHeight}},{key:"componentWillUnmount",value:function(){document.onkeydown=null}},{key:"renderChatContent",value:function(){var e=this,t=[],a=this.props.match.params.id,n=this.props.store.getRawChats(a),r=this.props.store.avatar,s=0;if(n.forEach)return n.forEach((function(a){t.push(d.a.createElement("div",{className:"mechat-chat-item"+(1===a.from?" from-me":""),key:s++},d.a.createElement("div",{className:"mechat-chat-item-avatar"},d.a.createElement("img",{src:0===a.from?e.getAvatar(e.props.store.chattingWith.avatar):r,alt:"avatar"})),d.a.createElement("div",{className:"mechat-chat-item-blob"},a.content)))})),t;this.props.store.reloadMessageList()}},{key:"sendMessage",value:function(){var e=this.textarea.value,t=this.props.match.params.id;this.props.store.sendMessage(t,e,"string"),this.textarea.value="",this.chatContent.scrollTop=this.chatContent.scrollHeight,b.a.post(v.a.apiUrl+"sendMessage",{data:{uid:this.props.store.uid,to:t,type:"string",content:e,token:this.props.store.token}}).then((function(e){if(200!==e.status)return alert("\u53d1\u9001\u4fe1\u606f\u5931\u8d25\uff0c\u539f\u56e0\u53ef\u80fd\u662f\uff1a"+e.message),void console.log(e)}))}},{key:"render",value:function(){var e=this;return d.a.createElement("div",{className:"mechat-chat-page"},d.a.createElement("div",{className:"mechat-chat-title"},this.props.store.chattingWith.nickname),d.a.createElement("div",{className:"mechat-chat-content",ref:function(t){return e.chatContent=t}},e.renderChatContent()),d.a.createElement("div",{className:"mechat-chat-textarea"},d.a.createElement("textarea",{name:"chat-text",ref:function(t){return e.textarea=t}}),d.a.createElement("button",{className:"mechat-chat-send",onClick:function(){return e.sendMessage()}},"\u53d1\u9001")))}}]),t}(_.Component))||s)||s),w=Object(g.e)(D),j=(a(209),Object(f.b)("store")(i=Object(f.c)(i=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"renderFriendsList",value:function(){var e=[],t=0;return this.props.store.friends.forEach((function(a){e.push(d.a.createElement(E.c,{className:"mechat-dialog",to:"/app/friends/"+a.uid,key:t++},d.a.createElement("div",{className:"mechat-dialog-avatar"},d.a.createElement("img",{src:v.a.apiUrl+"avatar/"+a.avatar,alt:"avatar"})),d.a.createElement("div",{className:"mechat-dialog-meta"},d.a.createElement("p",{className:"mechat-dialog-title"},a.nickname),d.a.createElement("p",{className:"mechat-dialog-mess"},a.signature))))})),e}},{key:"componentWillMount",value:function(){var e=this,t=v.a.apiUrl+"friends";b.a.post(t,{data:{uid:this.props.store.uid,token:this.props.store.token}}).then((function(t){200!==t.status?(alert("\u8eab\u4efd\u8ba4\u8bc1\u51fa\u73b0\u95ee\u9898\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002"),sessionStorage.removeItem("userInfo"),e.props.history.push("/")):e.props.store.updateFriends(t.payload)}))}},{key:"addFriend",value:function(){var e=this,t=this.input.value,a=v.a.apiUrl+"addFriend";b.a.post(a,{data:{uid:this.props.store.uid,token:this.props.store.token,friend:t}}).then((function(t){403===t.status?(alert("\u8eab\u4efd\u8ba4\u8bc1\u51fa\u73b0\u95ee\u9898\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002"),sessionStorage.removeItem("userInfo"),e.props.history.push("/")):200==t.status?(alert("\u6dfb\u52a0\u597d\u53cb\u6210\u529f."),e.props.store.addFriend(t.payload)):alert("\u6dfb\u52a0\u597d\u53cb\u5931\u8d25\uff0c\u539f\u56e0\u662f\uff1a"+t.message)}))}},{key:"render",value:function(){var e=this;return d.a.createElement("div",{className:"mechat-messages"},d.a.createElement("h1",{className:"mechat-messages-title"},"\u670b\u53cb"),d.a.createElement("div",{className:"mechat-friends-add"},d.a.createElement("input",{type:"text",name:"friends",placeholder:"\u641c\u7d22 MeChat \u8d26\u53f7\u6dfb\u52a0\u597d\u53cb",ref:function(t){return e.input=t}}),d.a.createElement("button",{onClick:function(){return e.addFriend()}},"+")),d.a.createElement("div",{className:"mechat-messages-list"},e.renderFriendsList()))}}]),t}(_.Component))||i)||i),A=(a(210),Object(f.b)("store")(o=Object(f.c)(o=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"chatWith",value:function(e,t,a){this.props.store.messageList[e]||this.props.store.addDialog(e),this.props.store.setChattingWith(e,t,a)}},{key:"getAvatar",value:function(e){return v.a.apiUrl+"avatar/"+e}},{key:"render",value:function(){var e,t=this,a=this.props.match.params.id;return this.props.store.uidKeyMap[a]&&(e=this.props.store.uidKeyMap[a]),console.log(e),d.a.createElement("div",{className:"mechat-profile-page"},d.a.createElement("p",{className:"mechat-profile-title"},"\u4e2a\u4eba\u8d44\u6599"),d.a.createElement("div",{className:"mechat-profile-container"},d.a.createElement("div",{className:"mechat-profile-avatar"},d.a.createElement("img",{src:this.getAvatar(e.avatar),alt:"avatar"})),d.a.createElement("div",{className:"mechat-profile-meta"},d.a.createElement("h1",{className:"mechat-profile-nickname"},e.nickname),d.a.createElement("p",{className:"mechat-profile-account"},"MeChat \u8d26\u53f7\uff1a",e.username),d.a.createElement("p",{className:"mechat-profile-signature"},e.signature),d.a.createElement(E.b,{className:"mechat-profile-chat",to:"/app/message/"+e.uid,onClick:function(){return t.chatWith(e.uid,e.nickname,e.avatar)}},"\u804a\u5929"))))}}]),t}(_.Component))||o)||o),C=Object(g.e)(A),I=Object(f.b)("store")(c=Object(f.c)(c=function(e){function t(){return Object(l.a)(this,t),Object(p.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"createSocketConnection",value:function(){var e=this;this.ws=new WebSocket(v.a.wsUrl);var t=this.ws;t.addEventListener("open",(function(){console.log("WebSocket opened."),t.send(JSON.stringify({uid:e.props.store.uid,token:e.props.store.token}))})),t.addEventListener("message",(function(t){switch((t=JSON.parse(t.data)).type){case"message":e.props.store.pushNewMessage(t.from,t.payload)}})),t.addEventListener("error",(function(){alert("\u8fde\u63a5\u9519\u8bef\u3002\u8fd4\u56de\u767b\u5f55\u9875\u9762..."),e.props.history.push("/")}))}},{key:"componentWillMount",value:function(){var e=this;null==sessionStorage.getItem("userInfo")?this.props.history.push("/"):this.props.store.setUserInfo(JSON.parse(sessionStorage.getItem("userInfo"))),this.createSocketConnection();var t=v.a.apiUrl+"friends";b.a.post(t,{data:{uid:this.props.store.uid,token:this.props.store.token}}).then((function(t){200!==t.status?(alert("\u8eab\u4efd\u8ba4\u8bc1\u51fa\u73b0\u95ee\u9898\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55\u3002"),sessionStorage.removeItem("userInfo"),e.props.history.push("/")):e.props.store.updateFriends(t.payload)})),this.props.store.reloadMessageList()}},{key:"componentWillUnmount",value:function(){this.ws.close()}},{key:"componentDidMount",value:function(){window.browserWindow.getCurrentWindow().setSize(800,600)}},{key:"render",value:function(){return d.a.createElement("div",{className:"mechat-mainpage"},d.a.createElement(E.a,{history:this.props.history},d.a.createElement(g.a,{path:"/app"},d.a.createElement(k,null)),d.a.createElement(g.a,{path:"/app/message"},d.a.createElement(M,null)),d.a.createElement(g.a,{path:"/app/message/:id"},d.a.createElement(w,null)),d.a.createElement(g.a,{path:"/app/friends"},d.a.createElement(j,null)),d.a.createElement(g.a,{path:"/app/friends/:id"},d.a.createElement(C,null))))}}]),t}(_.Component))||c)||c;t.a=Object(g.e)(I)},112:function(e,t,a){e.exports=a(113)},113:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__),react_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(39),react_dom__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react_dom__WEBPACK_IMPORTED_MODULE_1__),mobx_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6),react_router__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5),react_router_dom__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(15),history__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(18),_styles_index_styl__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(118),_styles_index_styl__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_styles_index_styl__WEBPACK_IMPORTED_MODULE_6__),_components_TopButton__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(105),_components_LoginPage__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(106),_components_RegisterPage__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(109),_components_MainPage__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(111),_models__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(110);eval('window.browserWindow = require("electron").remote');var history=Object(history__WEBPACK_IMPORTED_MODULE_5__.a)(),store=new _models__WEBPACK_IMPORTED_MODULE_11__.a;react_dom__WEBPACK_IMPORTED_MODULE_1___default.a.render(react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{className:"mechat",id:"mechat"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(mobx_react__WEBPACK_IMPORTED_MODULE_2__.a,{store:store},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_components_TopButton__WEBPACK_IMPORTED_MODULE_7__.a,null),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react_router_dom__WEBPACK_IMPORTED_MODULE_4__.a,{history:history},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react_router__WEBPACK_IMPORTED_MODULE_3__.a,{path:"/",exact:!0},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_components_LoginPage__WEBPACK_IMPORTED_MODULE_8__.a,null)),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react_router__WEBPACK_IMPORTED_MODULE_3__.a,{path:"/register",exact:!0},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_components_RegisterPage__WEBPACK_IMPORTED_MODULE_9__.a,null)),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react_router__WEBPACK_IMPORTED_MODULE_3__.a,{path:"/app"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_components_MainPage__WEBPACK_IMPORTED_MODULE_10__.a,null))))),document.getElementById("root"))},118:function(e,t,a){},119:function(e,t,a){},122:function(e,t){},124:function(e,t){},158:function(e,t){},159:function(e,t){},201:function(e,t,a){},206:function(e,t,a){},207:function(e,t,a){},208:function(e,t,a){},209:function(e,t,a){},210:function(e,t,a){},7:function(e,t,a){"use strict";t.a={apiUrl:"http://103.81.187.96:61616/",wsUrl:"ws://103.81.187.96:61616/entry"}}},[[112,1,2]]]);
//# sourceMappingURL=main.5981a7c5.chunk.js.map