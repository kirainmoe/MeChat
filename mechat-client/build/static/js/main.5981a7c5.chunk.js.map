{"version":3,"sources":["images/defaultAvatar.jpg","components/TopButton.js","components/LoginPage.js","components/RegisterPage.js","models/index.js","components/Navbar.js","components/MessageList.js","components/ChatPage.js","components/FriendsList.js","components/ProfilePage.js","components/MainPage.js","index.js","config.js"],"names":["module","exports","TopButton","maximized","window","close","browserWindow","getCurrentWindow","minimize","this","unmaximize","maximize","className","onClick","closeWindow","minimizeWindow","maximizeWindow","Component","LoginPage","inject","observer","props","state","nickname","avatar","require","username","usernameInput","value","password","crypto","createHash","update","passwordInput","digest","loginUri","config","apiUrl","honoka","post","data","then","res","JSON","parse","console","log","status","alert","message","sessionStorage","setItem","stringify","history","push","setSize","focus","src","alt","type","name","ref","placeholder","login","to","withRouter","RegisterPage","mail","mailInput","nicknameInput","regUri","register","Model","uid","messageList","records","user","signature","id","token","friend","friends","uidKeyMap","forEach","socket","socketLink","with","last","Date","read","dialog","chattingWith","content","addDialog","timestamp","from","fetching","MessageListUri","replaceDialog","payload","msg","observable","nickanme","get","action","Navbar","removeItem","store","title","logOut","MessageList","item","setRead","setChattingWith","cnt","key","date","today","dateStr","getMonth","getDate","getHours","getMinutes","chatWith","getAvatar","length","style","display","renderMessageList","ChatPage","document","onkeydown","e","keycode","which","keyCode","ctrlKey","sendMessage","chatContent","scrollTop","scrollHeight","chats","match","params","rawChats","getRawChats","myAvatar","chat","reloadMessageList","text","textarea","renderChatContent","FriendsList","friendUri","updateFriends","input","addFriendUrl","addFriend","renderFriendsList","ProfilePage","MainPage","ws","WebSocket","wsUrl","addEventListener","send","pushNewMessage","getItem","setUserInfo","createSocketConnection","path","eval","createBrowserHistory","ReactDOM","render","exact","getElementById"],"mappings":"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","file":"static/js/main.5981a7c5.chunk.js","sourcesContent":["module.exports = \"data:image/jpeg;base64,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\"","import React, { Component } from 'react';\r\n\r\nimport '../styles/TopButton.styl';\r\n\r\nexport default class TopButton extends Component {\r\n    maximized = false;\r\n\r\n    closeWindow() {\r\n        window.close();\r\n    }\r\n\r\n    minimizeWindow() {\r\n        window.browserWindow.getCurrentWindow().minimize();\r\n    }\r\n\r\n    maximizeWindow() {\r\n        if (this.maximized)\r\n            window.browserWindow.getCurrentWindow().unmaximize();\r\n        else\r\n            window.browserWindow.getCurrentWindow().maximize();\r\n        this.maximized = !this.maximized;\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className='mechat-top-button-container'>\r\n                <button className='mechat-top-button-exit' onClick={() => this.closeWindow()} />\r\n                <button className='mechat-top-button-minimize' onClick={() => this.minimizeWindow()} />\r\n                <button className='mechat-top-button-maxmize' onClick={() => this.maximizeWindow()} />\r\n            </div>\r\n        );\r\n    }\r\n}","import React, { Component } from \"react\";\r\nimport { Link, withRouter } from \"react-router-dom\";\r\n\r\nimport crypto from \"crypto\";\r\nimport honoka from \"honoka\";\r\n\r\nimport \"../styles/LoginPage.styl\";\r\nimport config from \"../config\";\r\nimport { inject, observer } from \"mobx-react\";\r\n\r\n@inject('store')\r\n@observer\r\nclass LoginPage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      nickname: \"MeChat\",\r\n      avatar: require(\"../images/defaultAvatar.jpg\")\r\n    };\r\n  }\r\n\r\n  login() {\r\n    const username = this.usernameInput.value,\r\n      password = crypto\r\n        .createHash(\"md5\")\r\n        .update(this.passwordInput.value)\r\n        .digest(\"hex\");\r\n    const loginUri = config.apiUrl + \"login\";\r\n    honoka\r\n      .post(loginUri, {\r\n        data: {\r\n          username,\r\n          password\r\n        }\r\n      })\r\n      .then(res => {\r\n        if (typeof res == \"string\") res = JSON.parse(res);\r\n        console.log(res);\r\n\r\n        if (res.status !== 200) {\r\n          console.log(res, typeof res);\r\n          alert(\"登录失败，错误信息：\" + res.message);\r\n        } else {\r\n          res.avatar = config.apiUrl + 'avatar/' + res.avatar;\r\n          sessionStorage.setItem(\"userInfo\", JSON.stringify(res));\r\n          this.props.history.push('/app/message');\r\n        }\r\n      });\r\n  }\r\n\r\n  componentDidMount() {\r\n      window.browserWindow.getCurrentWindow().setSize(300, 500);\r\n      this.usernameInput.focus();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"mechat-loginpage\">\r\n        <div className=\"mechat-login-personinfo\">\r\n          <p className=\"mechat-login-avatar-container\">\r\n            <img\r\n              className=\"mechat-login-avatar\"\r\n              src={this.state.avatar}\r\n              alt=\"avatar\"\r\n            />\r\n          </p>\r\n          <p className=\"mechat-login-nickname\">{this.state.nickname}</p>\r\n        </div>\r\n        <input\r\n          type=\"text\"\r\n          name=\"username\"\r\n          className=\"mechat-login-input-username\"\r\n          ref={ref => (this.usernameInput = ref)}\r\n          placeholder=\"用户名\"\r\n        />\r\n        <input\r\n          type=\"password\"\r\n          name=\"password\"\r\n          className=\"mechat-login-input-password\"\r\n          ref={ref => (this.passwordInput = ref)}\r\n          placeholder=\"密码\"\r\n        />\r\n        <div className=\"mechat-login-actions\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => this.login()}\r\n            className=\"mechat-login-button\"\r\n          >\r\n            登录\r\n          </button>\r\n          <Link to=\"/register\" className=\"mechat-login-register\">\r\n            没有账号？注册一个\r\n          </Link>\r\n        </div>\r\n        <div className=\"mechat-login-copyright\">\r\n          &copy;2019 XMU CS - Data Structure Experiment / by Yume Maruyama\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(LoginPage);","import React, { Component } from \"react\";\nimport { Link, withRouter } from \"react-router-dom\";\n\nimport crypto from \"crypto\";\nimport honoka from \"honoka\";\n\nimport \"../styles/RegisterPage.styl\";\nimport config from '../config';\n\nclass RegisterPage extends Component {\n  register() {\n    const username = this.usernameInput.value,\n      password = crypto.createHash('md5').update(this.passwordInput.value).digest('hex'),\n      mail = this.mailInput.value,\n      nickname = this.nicknameInput.value;\n    \n    const regUri = config.apiUrl + 'register';\n    honoka.post(regUri, {\n      data: {\n        username,\n        password,\n        mail,\n        nickname\n      }\n    }).then(res => {\n      if (typeof res == 'string')\n        res = JSON.parse(res);\n        if (res.status !== 200) {\n          console.log(res, typeof res);\n          alert(\"注册失败，错误信息：\" + res.message);\n        } else {\n          alert(\"注册成功~将回到登录页面。\");\n          this.props.history.push('/');\n        }\n    });\n  }\n\n  render() {\n    return (\n      <div className=\"mechat-register-page\">\n        <h1 className=\"mechat-register-title\">\n          注册 MeChat\n        </h1>\n        <input\n          type=\"text\"\n          name=\"username\"\n          className=\"mechat-register-input-username\"\n          ref={ref => (this.usernameInput = ref)}\n          placeholder=\"登录用户名\"\n        />\n        <input\n          type=\"password\"\n          name=\"password\"\n          className=\"mechat-register-input-password\"\n          ref={ref => (this.passwordInput = ref)}\n          placeholder=\"密码\"\n        />\n        <input\n          type=\"mail\"\n          name=\"mail\"\n          className=\"mechat-register-input-mail\"\n          ref={ref => (this.mailInput = ref)}\n          placeholder=\"邮箱\"\n        />\n        <input\n          type=\"text\"\n          name=\"nickname\"\n          className=\"mechat-register-input-nickname\"\n          ref={ref => (this.nicknameInput = ref)}\n          placeholder=\"昵称\"\n        />\n\n        <div className=\"mechat-register-actions\">\n          <button\n            type=\"button\"\n            onClick={() => this.register()}\n            className=\"mechat-register-button\"\n          >\n            注册\n          </button>\n          <Link to=\"/\" className=\"mechat-register-login\">\n            已有账号？登录\n          </Link>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withRouter(RegisterPage);\n","import { observable, action, get } from 'mobx';\r\nimport config from '../config';\r\nimport honoka from 'honoka';\r\n\r\nexport default class Model {\r\n    @observable nickname = null;\r\n    @observable username = null;\r\n    @observable uid = null;\r\n    @observable mail = null;\r\n    @observable signature = null;\r\n    @observable avatar = require('../images/defaultAvatar.jpg');\r\n    @observable token = null;\r\n    @observable friends = [];\r\n    @observable groups = [];\r\n\r\n    @observable socketLink = null;\r\n    @observable messageList = {};\r\n    @observable currentDialog = null;\r\n    @observable chattingWith = {\r\n        uid: null,\r\n        nickanme: null,\r\n        avatar: null\r\n    };\r\n    @observable uidKeyMap = {};\r\n\r\n    @observable fetching = false;\r\n \r\n    @get\r\n    getRawChats(uid) {\r\n        if (!this.messageList[uid]) {\r\n            return {};\r\n        }\r\n        return this.messageList[uid].records;\r\n    }\r\n\r\n    @action\r\n    setUserInfo(user) {\r\n        console.log(user);\r\n        this.nickname = user.nickname;\r\n        this.username = user.username;\r\n        this.signature = user.signature;\r\n        this.uid = user.id;\r\n        this.avatar = user.avatar;\r\n        this.token = user.token;\r\n        this.mail = user.mail;\r\n    } \r\n\r\n    @action\r\n    addFriend(friend) {\r\n        this.friends.push(friend);\r\n        this.uidKeyMap[friend.uid] = friend;\r\n    }\r\n\r\n    @action\r\n    updateFriends(friends) {\r\n        this.friends = friends;\r\n        friends.forEach(friend => {\r\n            this.uidKeyMap[friend.uid] = friend;\r\n        });\r\n    }\r\n\r\n    @action\r\n    connectSocketLink(socket) {\r\n        this.socketLink = socket;\r\n    }\r\n\r\n    @action\r\n    addDialog(uid) {\r\n        this.messageList[uid] = {\r\n            with: uid,\r\n            nickname: this.uidKeyMap[uid].nickname,\r\n            avatar: this.uidKeyMap[uid].avatar,\r\n            last: Date.parse(new Date()),\r\n            read: false,\r\n            records: []\r\n        };\r\n    }\r\n\r\n    @action\r\n    replaceDialog(dialog) {\r\n        this.messageList = dialog;\r\n    }\r\n\r\n    @action\r\n    setChattingWith(uid, nickname, avatar) {\r\n        this.chattingWith = {\r\n            uid,\r\n            nickname,\r\n            avatar\r\n        };\r\n    }\r\n\r\n    @action\r\n    sendMessage(uid, content, type) {\r\n        if (!this.messageList[uid]) {\r\n            this.addDialog(uid);\r\n        }\r\n        const timestamp = Date.parse(new Date());\r\n        this.messageList[uid].records.push({\r\n            from: 1,\r\n            timestamp: timestamp,\r\n            type,\r\n            content\r\n        });\r\n        this.messageList[uid].last = timestamp;\r\n        // todo: sort message list\r\n    }\r\n\r\n    @action\r\n    setRead(uid) {\r\n        this.messageList[uid].read = true;\r\n    }\r\n\r\n    @action\r\n    reloadMessageList() {\r\n        this.fetching = true;\r\n        const MessageListUri = config.apiUrl + 'getMessageList';\r\n        honoka.post(MessageListUri, {\r\n          data: {\r\n            uid: this.uid,\r\n            token: this.token\r\n          }\r\n        }).then(res => {\r\n          if (res.status !== 200) {\r\n            alert(\"拉取消息列表失败 :(\");\r\n            return;\r\n          }\r\n          this.replaceDialog(res.payload);\r\n          this.fetching = false;\r\n        });\r\n    }\r\n\r\n    @action\r\n    pushNewMessage(from, msg) {\r\n        console.log(from, this.messageList, this.uidKeyMap);\r\n        if (!this.messageList[from]) {\r\n            this.addDialog(from);\r\n        }\r\n        this.messageList[from].read = false;\r\n        this.messageList[from].records.push(msg);\r\n    }\r\n}","import React, { Component } from 'react';\r\nimport { withRouter } from 'react-router';\r\nimport { NavLink, Link } from 'react-router-dom';\r\nimport { inject, observer } from 'mobx-react';\r\n\r\n@inject('store')\r\n@observer\r\nclass Navbar extends Component {\r\n    logOut() {\r\n        sessionStorage.removeItem('userInfo');\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"mechat-mainpage-nav\">\r\n            <div className=\"mechat-nav-avatar-container\">\r\n              <img\r\n                className=\"mechat-nav-avatar\"\r\n                alt=\"avatar\"\r\n                src={this.props.store.avatar}\r\n                title={this.props.store.nickname}\r\n              />\r\n            </div>\r\n            <NavLink to=\"/app/message\" title=\"消息\">\r\n              <i className=\"fa fa-comments-o\"></i>\r\n            </NavLink>\r\n            <NavLink to=\"/app/friends\" title=\"通讯录\">\r\n              <i className=\"fa fa-address-book-o\"></i>\r\n            </NavLink>\r\n            <Link to=\"/\" title=\"注销\" onClick={() => this.logOut()}>\r\n              <i className=\"fa fa-mail-reply\"></i>\r\n            </Link>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withRouter(Navbar);","import React, { Component } from 'react';\r\nimport { inject, observer } from 'mobx-react';\r\nimport { NavLink } from 'react-router-dom';\r\nimport config from '../config';\r\n\r\n@inject('store')\r\n@observer\r\nclass MessageList extends Component {\r\n  getAvatar(avatar) {\r\n    return config.apiUrl + 'avatar/' + avatar;\r\n  }\r\n  \r\n  chatWith(item) {\r\n    this.props.store.setRead(item.with);\r\n    this.props.store.setChattingWith(item.with, item.nickname, item.avatar);\r\n  }\r\n\r\n  renderMessageList() {\r\n    const res = [];\r\n    let cnt = 0;\r\n\r\n    for (const key in this.props.store.messageList) {\r\n      const item = this.props.store.messageList[key],\r\n        date = new Date(item.last),\r\n        today = new Date();\r\n      \r\n      let dateStr = '';\r\n      if (date.getMonth() === today.getMonth() && date.getDate() === today.getDate()) {\r\n        dateStr += (date.getHours() < 10 ? '0' + date.getHours() : date.getHours());\r\n        dateStr += ':';\r\n        dateStr +=(date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes());\r\n      }\r\n\r\n      res.push(\r\n        <NavLink className=\"mechat-dialog\" to={\"/app/message/\" + item.with} key={cnt++} onClick={() => this.chatWith(item)}>\r\n          <div className=\"mechat-dialog-avatar\">\r\n            <img src={this.getAvatar(item.avatar)} alt=\"avatar\" />\r\n            {(item.read ? null : <span className={'mechat-dialog-new'}></span>)}\r\n          </div>\r\n          <div className=\"mechat-dialog-meta\">\r\n            <p className=\"mechat-dialog-title\">{item.nickname}</p>\r\n            <p className=\"mechat-dialog-mess\">{item.records.length ? item.records[item.records.length-1].content : ''}</p>\r\n            <span className=\"mechat-dialog-time\">{dateStr}</span>\r\n          </div>\r\n      </NavLink>\r\n      )\r\n    }\r\n\r\n    return res;\r\n  }\r\n  render() {\r\n    return (\r\n      <div className=\"mechat-messages\">\r\n        <h1 className=\"mechat-messages-title\">\r\n          消息列表\r\n        </h1>\r\n        <div className=\"mechat-messages-fetching\" style={{\r\n          display: this.props.store.fetching ? 'block' : 'none'\r\n        }}>\r\n          正在更新消息列表...\r\n        </div>\r\n        <div className=\"mechat-messages-list\">\r\n          {(() => this.renderMessageList())()}\r\n        </div>         \r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default MessageList;","import React, { Component } from \"react\";\r\nimport { inject, observer } from \"mobx-react\";\r\n\r\nimport \"../styles/ChatPage.styl\";\r\nimport { withRouter } from \"react-router\";\r\nimport config from \"../config\";\r\nimport honoka from \"honoka\";\r\n\r\n@inject(\"store\")\r\n@observer\r\nclass ChatPage extends Component {\r\n  getAvatar(avatar) {\r\n    return config.apiUrl + \"avatar/\" + avatar;\r\n  }\r\n\r\n  componentDidMount() {\r\n    document.onkeydown = (e) => {\r\n      const keycode = e.which ? e.which : e.keyCode;\r\n      if (e.ctrlKey && keycode === 13) {\r\n        this.sendMessage();\r\n      }\r\n    };\r\n\r\n    this.chatContent.scrollTop = this.chatContent.scrollHeight;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.onkeydown = null;\r\n  }\r\n\r\n  renderChatContent() {\r\n    const chats = [],\r\n      uid = this.props.match.params.id,\r\n      rawChats = this.props.store.getRawChats(uid),\r\n      myAvatar = this.props.store.avatar;\r\n\r\n    let cnt = 0;\r\n    if (!rawChats.forEach) {\r\n      this.props.store.reloadMessageList();\r\n      return;\r\n    }\r\n\r\n    rawChats.forEach(chat => {\r\n      chats.push(\r\n        <div\r\n          className={\"mechat-chat-item\" + (chat.from === 1 ? \" from-me\" : \"\")}\r\n          key={cnt++}\r\n        >\r\n          <div className=\"mechat-chat-item-avatar\">\r\n            <img\r\n              src={\r\n                chat.from === 0\r\n                  ? this.getAvatar(this.props.store.chattingWith.avatar)\r\n                  : myAvatar\r\n              }\r\n              alt=\"avatar\"\r\n            />\r\n          </div>\r\n          <div className=\"mechat-chat-item-blob\">{chat.content}</div>\r\n        </div>\r\n      );\r\n    });\r\n    return chats;\r\n  }\r\n\r\n  sendMessage() {\r\n    const text = this.textarea.value,\r\n      uid = this.props.match.params.id;\r\n    this.props.store.sendMessage(uid, text, 'string');\r\n    this.textarea.value = '';\r\n\r\n    this.chatContent.scrollTop = this.chatContent.scrollHeight;\r\n\r\n    honoka.post(config.apiUrl + 'sendMessage', {\r\n      data: {\r\n        uid: this.props.store.uid,\r\n        to: uid,\r\n        type: 'string',\r\n        content: text,\r\n        token: this.props.store.token\r\n      }\r\n    }).then(res => {\r\n      if (res.status !== 200) {\r\n        alert('发送信息失败，原因可能是：' + res.message);\r\n        console.log(res);\r\n        return;\r\n      }\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"mechat-chat-page\">\r\n        <div className=\"mechat-chat-title\">{this.props.store.chattingWith.nickname}</div>\r\n\r\n        <div className=\"mechat-chat-content\" ref={ref => this.chatContent = ref}>\r\n          {(() => this.renderChatContent())()}\r\n        </div>\r\n\r\n        <div className=\"mechat-chat-textarea\">\r\n          <textarea name=\"chat-text\" ref={ref => this.textarea = ref}></textarea>\r\n          <button className=\"mechat-chat-send\" onClick={() => this.sendMessage()}>发送</button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(ChatPage);\r\n","import React, { Component } from 'react';\r\nimport { inject, observer } from 'mobx-react';\r\nimport { NavLink } from 'react-router-dom';\r\nimport honoka from 'honoka';\r\n\r\nimport '../styles/FriendsList.styl';\r\nimport config from '../config';\r\n\r\n@inject('store')\r\n@observer\r\nclass FriendsList extends Component {\r\n  renderFriendsList() {\r\n    const res = [];\r\n    let cnt = 0;\r\n    this.props.store.friends.forEach(friend => {\r\n      res.push(\r\n        <NavLink className=\"mechat-dialog\" to={\"/app/friends/\" + friend.uid} key={cnt++}>\r\n          <div className=\"mechat-dialog-avatar\">\r\n            <img src={config.apiUrl + 'avatar/' + friend.avatar} alt=\"avatar\" />\r\n          </div>\r\n          <div className=\"mechat-dialog-meta\">\r\n            <p className=\"mechat-dialog-title\">{friend.nickname}</p>\r\n            <p className=\"mechat-dialog-mess\">{friend.signature}</p>\r\n          </div>\r\n        </NavLink>\r\n      );\r\n    });\r\n    return res;\r\n  }\r\n\r\n  componentWillMount() {\r\n    // get friends list\r\n    const friendUri = config.apiUrl + 'friends';\r\n    honoka.post(friendUri, {\r\n      data: {\r\n        uid: this.props.store.uid,\r\n        token: this.props.store.token\r\n      }\r\n    }).then(res => {\r\n      if (res.status !== 200) {\r\n        alert(\"身份认证出现问题，请重新登录。\");\r\n\r\n        sessionStorage.removeItem('userInfo');\r\n        this.props.history.push('/');\r\n      } else {\r\n        this.props.store.updateFriends(res.payload);\r\n      }\r\n    });    \r\n  }\r\n  \r\n  addFriend() {\r\n    const friend = this.input.value,\r\n      addFriendUrl = config.apiUrl + 'addFriend';\r\n      honoka.post(addFriendUrl, {\r\n        data: {\r\n          uid: this.props.store.uid,\r\n          token: this.props.store.token,\r\n          friend\r\n        }\r\n      }).then(res => {\r\n        if (res.status === 403) {\r\n          alert(\"身份认证出现问题，请重新登录。\");\r\n  \r\n          sessionStorage.removeItem('userInfo');\r\n          this.props.history.push('/');\r\n        } else {\r\n          if (res.status == 200) {\r\n            alert(\"添加好友成功.\");\r\n            this.props.store.addFriend(res.payload);\r\n          } else {\r\n            alert(\"添加好友失败，原因是：\" + res.message);\r\n          }\r\n        }\r\n      }); \r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"mechat-messages\">\r\n        <h1 className=\"mechat-messages-title\">\r\n          朋友\r\n        </h1>\r\n        <div className=\"mechat-friends-add\">\r\n          <input type=\"text\" name=\"friends\" placeholder=\"搜索 MeChat 账号添加好友\" ref={ref => this.input = ref}/>\r\n          <button onClick={() => this.addFriend()}>+</button>\r\n        </div>\r\n        <div className=\"mechat-messages-list\">\r\n          {(() => this.renderFriendsList())()}  \r\n        </div>         \r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default FriendsList;","import React, { Component } from \"react\";\r\nimport { inject, observer } from \"mobx-react\";\r\nimport { withRouter } from \"react-router\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nimport \"../styles/ProfilePage.styl\";\r\nimport config from \"../config\";\r\n\r\n@inject(\"store\")\r\n@observer\r\nclass ProfilePage extends Component {  \r\n  chatWith(uid, nickname, avatar) {\r\n      if (!this.props.store.messageList[uid])\r\n        this.props.store.addDialog(uid);\r\n      this.props.store.setChattingWith(uid, nickname, avatar);\r\n  }\r\n  \r\n  getAvatar(avatar) {\r\n    return config.apiUrl + \"avatar/\" + avatar;\r\n  }\r\n\r\n  render() {\r\n    const uid = this.props.match.params.id;\r\n    let user;\r\n    if (!this.props.store.uidKeyMap[uid]) {\r\n\r\n    } else {\r\n        user = this.props.store.uidKeyMap[uid];\r\n    }\r\n    console.log(user);\r\n    return (\r\n      <div className=\"mechat-profile-page\">\r\n        <p className=\"mechat-profile-title\">个人资料</p>\r\n        <div className=\"mechat-profile-container\">\r\n          <div className=\"mechat-profile-avatar\">\r\n            <img src={this.getAvatar(user.avatar)} alt=\"avatar\" />\r\n          </div>\r\n          <div className=\"mechat-profile-meta\">\r\n            <h1 className=\"mechat-profile-nickname\">{user.nickname}</h1>\r\n            <p className=\"mechat-profile-account\">MeChat 账号：{user.username}</p>\r\n\r\n            <p className=\"mechat-profile-signature\">{user.signature}</p>\r\n\r\n            <Link\r\n              className=\"mechat-profile-chat\"\r\n              to={\"/app/message/\" + user.uid}\r\n              onClick={() => this.chatWith(user.uid, user.nickname, user.avatar)}\r\n            >\r\n              聊天\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(ProfilePage);\r\n","import React, { Component } from \"react\";\r\n\r\nimport { Route } from \"react-router\";\r\nimport { HashRouter, withRouter } from \"react-router-dom\";\r\n\r\nimport { inject, observer } from \"mobx-react\";\r\n\r\nimport honoka from 'honoka';\r\n\r\nimport \"../styles/MainPage.styl\";\r\n\r\nimport config from \"../config\";\r\n\r\nimport Navbar from \"./Navbar\";\r\nimport MessageList from './MessageList';\r\nimport ChatPage from './ChatPage';\r\nimport FriendsList from \"./FriendsList\";\r\nimport ProfilePage from \"./ProfilePage\";\r\n\r\n@inject(\"store\")\r\n@observer\r\nclass MainPage extends Component {\r\n  createSocketConnection() {\r\n    this.ws = new WebSocket(config.wsUrl);\r\n    const ws = this.ws;\r\n\r\n    ws.addEventListener('open', () => {\r\n      console.log('WebSocket opened.');\r\n      ws.send(JSON.stringify({\r\n        uid: this.props.store.uid,\r\n        token: this.props.store.token\r\n      }));\r\n    });\r\n\r\n    ws.addEventListener('message', (msg) => {\r\n      msg = JSON.parse(msg.data);\r\n      switch (msg.type) {\r\n        case 'message':\r\n          this.props.store.pushNewMessage(msg.from, msg.payload);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n\r\n\r\n    ws.addEventListener('error', () => {\r\n      alert(\"连接错误。返回登录页面...\");\r\n      this.props.history.push('/');\r\n    });\r\n  }\r\n\r\n  componentWillMount() {\r\n    if (sessionStorage.getItem(\"userInfo\") == null)\r\n      this.props.history.push(\"/\");\r\n    else\r\n      this.props.store.setUserInfo(\r\n        JSON.parse(sessionStorage.getItem(\"userInfo\"))\r\n      );\r\n    \r\n    // establish socket connection\r\n    this.createSocketConnection();\r\n\r\n    // get friends list\r\n    const friendUri = config.apiUrl + 'friends';\r\n    honoka.post(friendUri, {\r\n      data: {\r\n        uid: this.props.store.uid,\r\n        token: this.props.store.token\r\n      }\r\n    }).then(res => {\r\n      if (res.status !== 200) {\r\n        alert(\"身份认证出现问题，请重新登录。\");\r\n\r\n        sessionStorage.removeItem('userInfo');\r\n        this.props.history.push('/');\r\n      } else {\r\n        this.props.store.updateFriends(res.payload);\r\n      }\r\n    });\r\n\r\n    this.props.store.reloadMessageList();\r\n  }\r\n  componentWillUnmount() {\r\n    this.ws.close();\r\n  }\r\n\r\n  componentDidMount() {\r\n    window.browserWindow.getCurrentWindow().setSize(800, 600);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"mechat-mainpage\">\r\n        <HashRouter history={this.props.history}>\r\n          <Route path='/app'>\r\n            <Navbar />\r\n          </Route>\r\n          \r\n          <Route path='/app/message'>\r\n            <MessageList />\r\n          </Route>\r\n\r\n          <Route path='/app/message/:id'>\r\n            <ChatPage />\r\n          </Route>\r\n\r\n          <Route path='/app/friends'>\r\n            <FriendsList/>\r\n          </Route>\r\n\r\n          <Route path='/app/friends/:id'>\r\n            <ProfilePage/>\r\n          </Route>\r\n        </HashRouter>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(MainPage);\r\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport { Provider } from 'mobx-react';\nimport { Route } from \"react-router\";\nimport { HashRouter } from 'react-router-dom';\nimport { createBrowserHistory } from \"history\";\n\nimport './styles/index.styl';\n\nimport TopButton from './components/TopButton';\nimport LoginPage from './components/LoginPage';\nimport RegisterPage from './components/RegisterPage';\nimport MainPage from './components/MainPage';\n\nimport Model from './models';\n\n// eslint-disable-next-line\neval('window.browserWindow = require(\"electron\").remote');\n\nconst history = createBrowserHistory(),\n    store = new Model();\n\nReactDOM.render((\n    <div className=\"mechat\" id=\"mechat\">\n        <Provider store={store}>\n            <TopButton />\n            <HashRouter history={history}>\n                <Route path=\"/\" exact>\n                    <LoginPage />\n                </Route>\n                <Route path=\"/register\" exact>\n                    <RegisterPage />\n                </Route>\n                <Route path=\"/app\">\n                    <MainPage />\n                </Route>\n            </HashRouter>\n        </Provider>\n    </div>\n), document.getElementById('root'));\n","export default {\r\n    apiUrl: 'http://103.81.187.96:61616/',\r\n    wsUrl: 'ws://103.81.187.96:61616/entry',\r\n};"],"sourceRoot":""}